# import process_encryption
# text = """YCEREVVT LTF IEWHXBX XAL VFAANF KMZKJVVH DS VDYQ LNLERH LNGH KAIOC SNQ ZEIOC AVGH AABGHZ OEBA JCLRGCUM SNQ WAL GCLPDRBVQ XTVWJGVLJ AQBGXRG MH ZAY QAMKK MV GALIZ FKJ YLNQ RIL KXBKHPHJK ST YHPA VUVEDIZF AEVZWR FQAQW XWOA FAL JTZWZKENT GCEQIHG UZ KARTWM XNLHPTCS UCTH IHQHV JAEKK JTF EVVR PZNT SABGAZ LKRPPTH EZ UWLWD OA BVCTE MH RHJJRD RILJWPGZW ZLRUHH DNQ STRARD OTSO WZLIT LETAPV BIL IVJZAE XAL JTFK TT VCRIZLHR NGGIVFT NM AA SRIRYCH TAL QUONA HT YAE GCLPHRBVIN NRDK YNQ RIL ERQEWAA UCLRGCWM IA YXZVAVVT CDITP LL AWTVJLW UM KIKCZD UV GAIA ZLPW MFXKRYEH EZ MIL FKJ YPADHV JSLFMLBCS NJZFHGXIVJ SLW DG AMNL EUCR ANQ ESRVZ VFAMNF ZHVZ PZGL MAEMZ CTDZW SNQ WHL QAFRLP ST YAE QQR ULVV ET VCRIZLHR VA OKFJERVVT HZ RAL HDY CBEHUMLXH DND VLTRMDVT ZAL MQR PCTVJ DDHT TALC ACN GH SET ARFIHQ WAL JTFT FAGLEJ PRTL KOAQ GCTL SLEAVUAN AALC RHC ORE WCSV NNQ EPBRS TSRVZ FVN WHWPTVRTX WGAQ WHEEK ZGZDVTXPJ OT F MGNBVL RH CVZVKAYFK OSLFSLBCM SNQ L IM FEQBIXH WH OGXVE AEBA AALQ QZZN FG TTF RLW SPA FFUFEL KSLFMLICM AA KLBTW L ROAMN NNQ L IM GHDHV YPA UQAYMND HBEHUMLXH WAOIAN P IM NFMVT A RFAMN FLBTW XEENF KGAQXAPVG ZH AQ IZZR FG TAR RWWY DWFA XLTBCG MNQ LBL YROFZWIM KMH ARZEVKALPPWK A NJAR KAHT LGCB GAE QQR JETW ENLE TH RDRBOV RNQ POFV WSVVGK QQXHVRV LH TJIH WAEQEWPGZW SNQ LF SB DGFUXVWK ZAS TFIR ZMDH M EITW DGCB UHVZ XO FVGQBFALHV NHHT B UGML WR HH GKX TS EMNL EUCD UFAMNF KSFJPY FVAQ ES HDGKABMP FJLLVT NPA TBUQ GCLRGCWM WWIBXH DNQ ZWTCJLH XHGBT SL NUXJKH WAHT MAL RFAMNF OAVV WMFKNKKMRGEJ UAAKORRH WALR FWNG T MQWKWRTKV TH GSLFMLBCM GFKJVZVT VTECG IV RBZJHNTK JTR KAL PLNQV GT HALPHRBVI ERIJYQ HGFAUAWH VSFJ TPSKSGK ELWOKEVT YSLFMLBUM LH FVXNLE GH RFAQ MN ML EGXVEH WH ZPEVZ GCLEHRBVI ANQ QRZEV IVXNLE GAL GALPHRBVQ PHD WWK QQBQLBBWBF RFAQ QGML TBBNDRB GAL VVQMIVIVT YGZOLMVJ GF YAL MFQA SPKOOB YPEVDVT ZALM MS ZVGLTGKW SNQ WAL GQRHB JGSL KVQMIV NT VCRIZLHR NRIZDDNT OV EFAQ AEBAOIN MAL GQRHB TOIFO FQBQHQZ FALFMLBCM LH QGRKTIV QHETA HND KL GQIFO QRZZR RGXVI XH GMWJ TXVDE TVN AL WLITW ADGKWWKWH TAL QABF YXRUJICM XTFXKVP YND L AMMHTGV AL LODTH WH HKRDH XHHT TNQ WAL VVQAIVVVT RPKOWBNNIZVW GT YAL MXQA MTF YPA GKJ FWVIHRA KCEREIVT UBYJ DTF YPS GKJ FSFJXR QSLFMLBCM JZACOD XHQHVVWLBUMTBVT NPA XTS FVT BV QRWVT YG VL ALDG IHQHVVWLIUMTXH WAL PZMAL LNQ XJGZONA MMRTWM XNLHPTUM UCTH KDV QQILO QRZZV SFXKRY RAL WGZOLMVJ UHQHV YPA UQAYANQ HBMDGAVT ZHPA XFTTL WLCM OT ODXJKQQRG LALFMLBCM UQBQEQZRH KPUEWPQ IV UPA GKJ JKFUS VR W SXBK PAL QIVQ RT F SGZOLMR CTSO GCTH PZ RHL KURV A LR MCERJ GT HCMBPIOTIVT NHVZ LHRUHNRH KPU MNQ KL LAS FBH MAL WMVULPXR RH VHRSPIR UDRB KNQ FWHAIVT ZAVIANAL EERGTL LGOTTBR IA FBH MAL QMRB OT F MMN YTSO GCTH ONQ KPALHFP WETW QTFXKX APM UV GKLNA AAL MXQA SPKOWB UHD SMZKJVVH VWZZRVPJ DWFA FAL PIOGTNLV XAHT PAS KDZKHJ BURWN GBONA TRFIHQ TALQ NZ ACLRGCUM SNQ KPA EQR QYQWRGXVP YNQ KUHTKV IRVVGKH TAL RBPMP VFAMNF ODV KAVV VVHUWGH WH SQMCKITXH JNVGLL UJVKSVT UB GAL FJBTXV SJTP ST YAL ARIFUGNPG ENQ RRPPCKWIM UTLEPER MT YALMZ TOAYMNQHV JSLFSLBCM SS KSLFMTBCM KUGRGXH WHL VRNX YRRIL FF RGNBVL ZFKOVNVVT ZH TNTW EAE EIZ YL TJHVAZEH WAL QQR JEBA DHGKUMTBWB FG MAJZH WH HXERJ BZ NXBR RALMZ TOAYMNQHV DMRTUM XNLHPTCM UCTH KWS XNVNLWJ PTVJMUDHH WH HRVET LWGTVXEJ WEBA JCLRGCWM FTF KAL WSKO ST HPA EQR GABM AB WWS LAHT VCTH VIUEWPQ YKVETXD ZEBA JCLRGCWS ZL GCRVJZFWJ PGVTPRVH D NRA FTFXKVP MT YAL CQRHB XNQ WHUKTALV NEBA AAL WTKFBTKWL HT YAE VVQMIVVVT RPGOWBANIZVW SRRVWLXH VSLFMLICM SNQ KPA YAURUV XTF KAL GTZMQW LALC FHD FQMYUBMXH DGGIVSL MAL VFAMN FGLOLMVJ AV RBZJANTK JTF JSFJ TASKSGK JWFA FAAT ALPW ZB RERKH JCTH CTKJVVH TAL JTFXKVP YND WAL TGZAGBRVS LH QCLRGCWM SNQ KPA EQR FG WB WWS LAHT VCTH ONQ KPA EQR EVXNRERH WH QCRIZLER GALMZ YLERKS ZLEVT UEBA AAE WZHMQ ST YALMR SBRXGIV JEBA TAL HHZDT TV GAE GQZO OTONA HT DDWJ PCTH AMRTHLH WAL WMLMDDOFJ OEBA AAL XPO OQKCTLE JQJGNT NPON IFJTFV TALQ ABGH ON NWAIBBVT HBRHKY PGFJDAAWBRH ZIBA CDBTLD SNQ WWTXV WTF WNDZ DDYQ SS ZL LHD DGXVIH ZEBA JCLGGCWM KLKRPETD WBONA MH VPA TORB SHQHV YPA SRDAIL YL GQBPGALPH WAL XKLY GODN MT YAL GQRHX EVZOLVT OV UPS TSVESLIALTX TAL WWGWLZBR MF WFAQ ENQ VG HAE MFQA SPKOWB PRFGKWH WAL WWE TH UKVDMNVI IVFJVZWF DMKSVT LLNQIFLW LT EFGJXHHG NBTTVJRLG FPK RDYQ DLTXV WWVIH IWFA TALMZ KHFDQRGOFJ UCLPHRBVQ ANQ UFAMN NLTSE XALC PVWLXH DNQ PMDH WSCTZNIKGW GT LUOTL SNQ VZLIT XV TXRTBBNXH JTF KALIZ JSFJ HHPTDZRRNPG SJZVTQAE AEBA LBEHUMLIWB GALC QDPTI UHGBT EALC FHD RVGQJZVVH VMZFNKKMRGEJ RH QOBGBVHY SB GH HHL JTFKKVWK ST NBJDWAMGAM ODEVV GCTH FVTDFTXH WH HAL PPKGTNM GT YAL BQA SEKOWB TKQUVN ANQ DT ELSL AHNQEH WAL GQRHB QH HPA KSFJ OOITXNT XVGGMDDVT COFU LV EFAQ ST YHL VVGQJZVP MT TAL GQRHB XNQ WHL VVXNLE BT YAE XPK OQKCTLE GAEWSR XXRNGXH TALQ MLW APRURN NNQ DWWRUHH SERFAWBF LH HAL SMLMDDJFJ WECH AH FVGGMDZ E FARD AT KNDZ LLVEHLCG IDLR GALY PVXBZVH IWFA MUTTBTRP QWVMIKG KRZFP UWS VERVMH WH HAVGW BSRVZ PPKOWBAAIZVW TVN B PVDE XAPA ZPALHFP WETW CVWLHFV XHLMZ YVBBIL VREQUMW GT WFAQ AEVV HHRVMH WAL CQRHB LQEWFETRLG NZ RAL KXVET LSCTZNNKGW GF HCTH ONQ KPA EER EVGQFULVT ZHLMZ KTLP MA HTRYHPH LAL QAGL IUBDFKTNG MTSK S PHVZ YHQHVKAKOR NS S HPALHRZIN NNQ LB IPINF EQ KXVETEJ RHHT MH QQBGBVHE XH DGFHXGV BB TAL XKLNA TGML BF GQBPGELPH IOF DMNL EKRRVRTBWBF LH QQAQ CEX B EETW CVWL BN CTECG OXBKEVG ZAHT MAHT MKLTA DETW ZBR HDY BF XHZO JAURUHD XHGBT EALR OZ TAL KRZFZWIM OOBQHVJ GT YAL ENPKMRG PKFCO"""
# text = process_encryption.process2(text)
# for j in range(12):
#     text = text[j:]
#     new = []
#     for i in range(len(text)):
#         if i % 12 == 0:
#             new.append(text[i])
#     print("".join(new))
# x = 0
# for i in range(1,21):
#     x += 21*i
# print(x)
from interface import *

class Cipher:

    def __init__(self):
        self.ciphertext = cipher_input.get('1.0', tk.END).replace('\n', '').replace('\r', '')

    class Manipulate:

        def __init__(self):
            self.ciphertext = cipher_input.get('1.0', tk.END).replace('\n', '').replace('\r', '')

        modified = False

        def get(self):
            return self.ciphertext

        def clean(self):
            return re.sub('[^A-Za-z0-9]+', '', self.ciphertext).upper()

        def store(self):
            alphabet = list("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz")
            self.nonalphabetic = []
            self.case = []
            for i in range(len(self.ciphertext)):
                if self.ciphertext[i] not in alphabet:
                    self.nonalphabetic.append([self.ciphertext[i], i])
                else:
                    if self.ciphertext[i].islower() is True:
                        self.case.append(i)

        def restore(self, dtext):
            dtext = list(dtext)
            for i in range(len(self.nonalphabetic)):
                dtext.insert(self.nonalphabetic[i][1], self.nonalphabetic[i][0])
            for i in range(len(self.case)):
                dtext[self.case[i]] = dtext[self.case[i]].lower()
            return "".join(dtext)

        def reverse_words(self):
            if self.modified == False:
                self.store()
            raw = Cipher().get()
            words_spaces = []
            for i in range(len(raw)):
                if raw[i] in list("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz "):
                    words_spaces.append(raw[i])
            words_spaces = "".join(words_spaces)
            reversed = []
            for word in words_spaces.split(' '):
                reversed.append(word[::-1])
            self.modified = True
            cipher_input.delete('1.0', tk.END)
            cipher_input.insert(tk.INSERT, self.restore("".join(reversed)))

        def reverse_string(self):
            if self.modified == False:
                self.store()
            raw = Cipher().get()
            cipher_input.delete('1.0', tk.END)
            cipher_input.insert(tk.END, raw[::-1])
            self.modified = True

        def reset(self):
            cipher_input.delete('1.0', tk.END)
            cipher_input.insert(tk.INSERT, self.get())

    class Decrypt:

        def __init__(self):
            self.ctext = cipher_input.get('1.0', tk.END).replace('\n', '').replace('\r', '')

        def crack_vigenere(self):
            ctext = Cipher.Manipulate(self).clean()
            global top10keys
            top10keys = ["" for x in range(10)]
            alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
            best_overall = -99e9
            count = 0
            for keylength in range(1, 16):
                parentkey = "A" * keylength
                parentscore = fitness.score(decrypt.vigenere(ctext, parentkey))
                parentkey = list(parentkey)
                best_starter_score = parentscore
                best_starter = "".join(parentkey)
                for i in range(keylength):
                    for letter in alphabet:
                        parentkey = list(parentkey)
                        child = parentkey
                        child[i] = letter
                        child = "".join(child)
                        childscore = fitness.score(decrypt.vigenere(ctext, child))
                        if childscore > best_starter_score:
                            best_starter_score = childscore
                            best_starter = child
                        if childscore > best_overall:
                            bestfitness.config(text=str(round(childscore)))
                            top10keys.append(child)
                            key_updater(top10keys)
                            best_overall = childscore
                            best_key = child
                            cipher_output.delete('1.0', tk.END)
                            cipher_output.insert(tk.INSERT, ctext_class.restore(decrypt.vigenere(ctext, best_key)))
                            cipher_output.update()
                        count += 1
                        keystested.config(text=str(count))
                        pbprogress.set(int((count / 3120) * 100))
                        pb.update()
                    parentkey = best_starter